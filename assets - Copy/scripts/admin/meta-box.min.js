!function(u){"use strict";u(document).ready(function(){var o=!1,e=u("#formatdiv"),a=!1,i=u(document),t=u("#loftocean-tmpl-format-meta-box");function n(e){o.children("div.format").css("display","none"),e&&-1!==["gallery"].indexOf(e)?o.children("div.format."+e).add(a).css("display",""):a.css("display","none"),o.find(".audio-code").val()||o.find(".clear-audio").hide()}u("body").on("change","select.loftocean-author-widget-choose-by",function(e){var a=u(this).val(),i=u(this).parent().siblings(".author-list-choices");switch(i.css("display","none"),a){case"name":i.filter(".author-list-by-name").css("display","");break;case"role":i.filter(".author-list-by-role").css("display","")}}).on("click",".loftocean-post-counter-wrap a",function(e){e.preventDefault();var a=u(this),i=a.siblings("input").first(),e=a.add(a.siblings("a")).not(".edit");a.hasClass("edit")?(a.css("display","none").siblings("a").css("display",""),i.removeAttr("readonly").attr("previous-value",i.val())):(e.css("display","none"),a.siblings("a.edit").css("display",""),a.hasClass("cancel")&&i.val(i.attr("previous-value")),i.attr("readonly","readonly"))}).on("change","#post_author_override",function(e){var a=u(this).val();u("#loftocean-single-post-co-authors").children().css("display","").filter("[value="+a+"]").css("display","none").removeAttr("selected")}),u("#loftocean-tmpl-format-meta-box").length&&u("#formatdiv").length&&(e.find(".inside").append(t.html()),o=e.find("#loftocean-format-media"),a=o.children("h4"),n(t.attr("data-format")||""),u("body").on("change","input[name=post_format]",function(e){n(u(this).val())}).on("click","#loftocean-format-media .format-media",function(e){e.preventDefault(),u(this).hasClass("gallery")?l.gallery.open():u(this).hasClass("video")?l.video.open():u(this).hasClass("audio")&&l.audio.open()}).on("change","#loftocean-format-media textarea",function(e){u(this).siblings("input[type=hidden]").length&&u(this).siblings("input[type=hidden]").val("")}).on("click","#loftocean-format-media .clear-audio",function(e){e.preventDefault();e=u(this).closest(".format.audio");u(this).hide(),e.find(".audio-code").val(""),e.find(".audio-id").val("")})),wp.loftocean={},wp.loftoceanMediaTools=function(){return wp.loftocean.roomThumbnail=new wp.media({editing:!0,library:{type:"image"},multiple:!1}),wp.loftocean.roomGallery=new wp.media({frame:"post",state:"gallery-edit",title:wp.media.view.l10n.editGalleryTitle,"media-sidebar":!1,editing:!1}),wp.loftocean.gallery=new wp.media({frame:"post",state:"gallery-edit",title:wp.media.view.l10n.editGalleryTitle,"media-sidebar":!1,editing:!1}),wp.loftocean.audio=new wp.media({library:{type:"audio"},title:wp.media.view.l10n.addMedia,multiple:!1}),wp.loftocean.video=new wp.media({library:{type:"video"},title:wp.media.view.l10n.addMedia,multiple:!1}),wp.loftocean.gallery.on("update",function(e){var a=wp.loftocean.gallery.state();(e=e||a.get("selection"))&&(o.find(".gallery-id").val(wp.loftocean.gallery.states.get("gallery-edit").get("library").pluck("id").join(",")),o.find(".gallery-code").val(wp.media.gallery.shortcode(e).string()))}).on("open",function(){var a=wp.loftocean.gallery.states.get("gallery-edit").get("library"),e=o.find(".gallery-id").val();e&&(e=e.split(",")).forEach(function(e){e=wp.media.attachment(e);e.fetch(),a.add(e?[e]:[])})}),wp.loftocean.video.on("select",function(e){var a=wp.loftocean.video.state(),i=(e=e||a.get("selection").first()).toJSON();o.find(".video-id").val(i.id),o.find(".video-code").val('<video width="'+i.width+'" height="'+i.height+'" src="'+i.url+'"></video>')}).on("open",function(){var e=wp.loftocean.video.state().get("selection"),a=o.find(".video-id").val();a&&((a=wp.media.attachment(a)).fetch(),e.add(a?[a]:[]))}),wp.loftocean.audio.on("select",function(e){var a=wp.loftocean.audio.state(),i={},t=(e=e||a.get("selection").first()).toJSON();i.src=t.url,o.find(".clear-audio").show(),o.find(".audio-id").val(t.id),o.find(".audio-code").val(wp.media.audio.shortcode(i).string())}).on("open",function(){var e=wp.loftocean.audio.state().get("selection"),a=o.find(".audio-id").val();a&&((a=wp.media.attachment(a)).fetch(),e.add(a?[a]:[]))}),wp.loftocean.roomThumbnail.on("select",function(e){var a=wp.loftocean.roomThumbnail.state(),i=(e=e||a.get("selection").first()).toJSON();o.find("[name=loftocean_room_list_thumbnail_id]").val(i.id),o.find(".list-thumbnail-has-image-wrapper .set-list-thumbnail").html('<img width="'+Math.min(i.width,254)+'" src="'+i.url+'">'),o.find(".list-thumbnail-has-image-wrapper").css("display","").end().find(".list-thumbnail-no-image-wrapper").css("display","none")}).on("open",function(){var e=wp.loftocean.roomThumbnail.state().get("selection"),a=o.find("[name=loftocean_room_list_thumbnail_id]").val();a&&((a=wp.media.attachment(a)).fetch(),e.add(a?[a]:[]))}),wp.loftocean.roomGallery.on("update",function(e){var a,i=wp.loftocean.roomGallery.state();(e=e||i.get("selection"))&&(e=wp.loftocean.roomGallery.states.get("gallery-edit").get("library"),a=u("<ul>"),e.pluck("url").forEach(function(e){a.append(u("<li>").append(u("<a>",{href:"#",class:"set-gallery"}).append(u("<img>",{src:e}))))}),o.find("[name=loftocean_room_gallery_ids]").val(e.pluck("id").join(",")),o.find(".gallery-no-image-wrapper").css("display","none").end().find(".gallery-preview-list").html("").append(a.children()).end().find(".gallery-has-image-wrapper").css("display",""))}).on("open",function(){var a=wp.loftocean.roomGallery.states.get("gallery-edit").get("library"),e=o.find("[name=loftocean_room_gallery_ids]").val();e?(e=e.split(",")).forEach(function(e){e=wp.media.attachment(e);e.fetch(),a.add(e?[e]:[])}):a.reset()}),wp.loftocean};var l=new wp.loftoceanMediaTools,s=new wp.loftoceanMediaTools;u(".page-video-meta-box").length&&(o=u(".page-video-meta-box"),u("body").on("click",".loftocean-page-upload-video",function(e){e.preventDefault(),l.video.open()}).on("change",".page-video-meta-box textarea",function(e){u(this).siblings("input[type=hidden]").length&&u(this).siblings("input[type=hidden]").val("")}));var d,r,c,p,f,m,h=u("#loftocean-room-list-thumbnail.postbox ");h.length&&(d=u("#loftocean-room-list-gallery.postbox"),r=u(".panel-wrap.room-data-settings"),h.on("click",".set-list-thumbnail",function(e){e.preventDefault(),o=h,s.roomThumbnail.open()}).on("click",".remove-list-thumbnail",function(e){e.preventDefault(),h.find("[name=loftocean_room_list_thumbnail_id]").val("-1"),h.find(".list-thumbnail-has-image-wrapper").css("display","none").end().find(".list-thumbnail-no-image-wrapper").css("display","")}),d.on("click",".set-gallery",function(e){e.preventDefault(),o=d,s.roomGallery.open()}).on("click",".remove-gallery",function(e){e.preventDefault(),d.find("[name=loftocean_room_gallery_ids]").val(""),d.find(".gallery-has-image-wrapper").css("display","none").end().find(".gallery-no-image-wrapper").css("display","").end().find(".gallery-preview-list").html("")}),r.length&&(c=r.find(".select2-field select"),p=u("select[name=page_template]"),e=r.find("input#room_price_by_people"),f=r.find(".form-field.price-by-people-unit"),t=r.find("#room_enable_weekend_prices"),m=r.find(".form-field.weekend-prices"),c.length&&c.select2({width:"95%"}).removeClass("hidden"),p.on("change",function(e){var a=r.find(".loftocean-room.room-options.tab-layout");a.length&&("default"==u(this).val()?a.css("display",""):(a.css("display","none"),a.hasClass("active")&&a.siblings(".tab-general").find("a").trigger("click")))}),e.on("change",function(e){this.checked?f.show():f.hide()}),t.on("change",function(e){this.checked?m.show():m.hide()}),r.on("click",".loftocean-room-settings-tabs > li > a",function(e){e.preventDefault();var a=u(this).parent(),e=u(this).attr("href");a.hasClass("active")||(a.siblings().removeClass("active").end().addClass("active"),r.children(".panel.loftocean-room-setting-panel").addClass("hidden"),r.children(e+"-panel, "+e).removeClass("hidden"),"#tab-availability"==e&&i.trigger("render.loftocean.room.availability"))}),r.on("click",".loftocean-room-rules-panel .loftocean-room-rules-item .item-title",function(e){u(this).toggleClass("toggled-on")})))})}(jQuery);
